<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">

    <title>Whatsapp Web</title>
</head>

<body>
    <div class="overlay-modal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Realize Login</h3>
            </div>
            <div class="modal-content">
                Login: <input id="nome-usuario" type="text" placeholder="Digite o nome do seu usuÃ¡rio...">
            </div>
            <div class="modal-footer">
                <button class="botao-modal" id="botao-blue">
                    Logar
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <nav>
                <div class="logo">
                    <img src="../imagens/chat-de-voz.png" alt="">
                </div>
                <span>
                    Messenger
                </span>

                <span class="usuario">
                    Ana Kely
                </span>
            </nav>
        </header>

        <div class="container-chat">

        </div>

        <form id="form-novo-grupo">
            <input id="grupo" type="text" placeholder="Insira um novo grupo">
            <br>
            <button type="submit">Inserir</button>
        </form>

        <div class="mensagens">
            <div class="mensagem">
                <ul>
                    <li></li>
                </ul>
            </div>
            <form action="">
                <input type="text" id="mensagem" placeholder="Escreva sua mensagem">
                <button>OK</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous">
        </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        /* MODAL */
        let overlayModal = document.querySelector(".overlay-modal");
        let logar = document.querySelector("#botao-blue");
        let input_nome = document.querySelector("#nome-usuario")

        logar.addEventListener("click", function () {
            overlayModal.classList.add("active");
        })

        /* GRUPOS */
        function postGroupAndUpdate(id, nome) {
            axios({
                method: "POST",
                url: "https://server-json-lms.herokuapp.com/grupos",
                data: {
                    todoId: id,
                    nome: nome
                }
            }).then((response) => {
                atualizarList()
            }).catch((error) => {
                console.log(error)
            })
        }


        let containerChat = document.querySelector(".container-chat")
        let mensagens = document.querySelector(".mensagens")
        id_grupo = ""

        function criarLista(id, nome) {
            let containerGroup = document.createElement("div")
            containerGroup.classList.add("list-group")

            let listGroup = document.createElement("div")
            listGroup.classList.add("grupos")

            let itemList = document.createElement("div")
            let imgGroup = document.createElement("img")
            let span = document.createElement("span")

            itemList.appendChild(imgGroup)
            imgGroup.src = '../imagens/icon-group.png'

            itemList.appendChild(imgGroup)
            itemList.appendChild(span)
            span.textContent = nome
            listGroup.appendChild(itemList)

            let linha = document.createElement("hr")
            listGroup.appendChild(linha)

            containerGroup.appendChild(listGroup)
            containerChat.appendChild(containerGroup)

            return containerGroup
        }


        function getGroupAndRender(grupo) {
            axios({
                method: "GET",
                url: "https://server-json-lms.herokuapp.com/grupos",
            }).then((response) => {
                let grupos = response.data
                let lista = criarLista(grupo.id, grupo.nome)
                containerChat.appendChild(listGroup)
            }).catch((error) => {
                console.log(error)
            })
        }

        function atualizarList() {
            containerChat.innerHTML = ""
            axios({
                method: "GET",
                url: "https://server-json-lms.herokuapp.com/grupos",
            }).then((response) => {
                let grupos = response.data
                for (let grupo of grupos) {
                    getGroupAndRender(grupo)
                }
            }).catch((error) => {
                console.log(error)
            })
        }

        atualizarList()


        let form_novo_todo = document.getElementById("form-novo-grupo")
        let input_form_titulo = document.querySelector("#form-novo-grupo #grupo")

        form_novo_todo.addEventListener("submit", (event) => {
            event.preventDefault()
            axios({
                method: "POST",
                url: "https://server-json-lms.herokuapp.com/grupos",
                data: {
                    nome: input_form_titulo.value,
                }
            }).then((response) => {
                atualizarList()
            }).catch((error) => {
                console.log(error)
            })
        })

    </script>

    <script>
        function criarMensagem(nome, corpo) {
            let container_mensagens = document.querySelector(".mensagens")
            let mensagem = document.querySelector(".mensagem")

            let lista_mensagens = document.querySelector("ul")
            let item_mensagem = document.querySelector("li")

            let nome_usuario = document.createElement("span")
            nome_usuario.textContent = nome

            let corpo = document.createElement("p")
            corpo.textContent = corpo

            container_mensagens.appendChild(mensagem)
            mensagem.appendChild(lista_mensagens)
            lista_mensagens.appendChild(item_mensagem)

            item_mensagem.appendChild(nome_usuario)
            item_mensagem.appendChild(corpo)

            return container_mensagens
        }

        /*
        listGroup.addEventListener("click", (event) => {
            function getMessageAndRender(grupo) {
                axios({
                    method: "GET",
                    url: "https://server-json-lms.herokuapp.com/grupos/"+grupo.id+"/mensagens",
                }).then((response) => {
                    let mensagens = response.data
                    let cardMensagem = criarMensagem(mensagens.nome, mensagens.corpo)
                    container_mensagens.appendChild(cardMensagem)
                }).catch((error) => {
                    console.log(error)
                })
            }
        })
        */
    </script>
</body>

</html>